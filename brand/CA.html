<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <title>new</title>
    <link href="./css/CA.css" rel="stylesheet" type="text/css" />
    
</head>
<body>
    <header>
        <div id="head">
            <nav>
                <div id="mob_menu">
                    <article>
                        <div></div>
                        <div></div>
                        <div></div>
                        <span class="mob_menu_switch_off"></span>
                    </article>
                </div>
                <ul class="flex">
                    <li><a href="index.html">홈으로 돌아가기</a></li>
                    <li><a href="L.html">로그인</a></li>
                    <li><a href="S.html">회원가입</a></li>
                    <li ><a href="M_1.html">마이페이지</a></li>
                    <li ><a href="CA.html">장바구니</a></li>
                    <li><a href="#"><img src="./images/lan.png" alt="icon_lan"/>KOR<img src="./images/tri.png" alt="icon_arrow_under"/></a></li>
                </ul>
            </nav>
            <h1 id="logo"><a href="ST.html">logo</a></h1>
        </div>
    </header>
<!--    컨텐츠 영역    -->

<hgroup class="wrap">
    <div id="bk_head">
        <h2>장바구니</h2>
        <hr/>
    </div>
    <div id = "counting_buckets">
        <h3>총 4건</h3> <!--버킷 건 (class=buckets) 갯수 카운트-->
        <hr/>
    </div>
</hgroup>
<section>
    <div class="wrap">
        <form>
            <div class="flex">
                <input id = "checkall" type="checkbox"> 
                <h4>전체선택</h4>
                <button name="delete_select_items" class="btn">선택 삭제</button>
            </div>
        </form>
        <article id="contents">
            <ul class="buckets flex">
                <li><input type="checkbox" name = "items"></li>
                <li>
                    <a href="#"><img src="./images/img3.png" alt="img3"/></a>
                   <!--무작위 난수-->
                </li>
                <li>
                    <h5 class="item_name">까스활명</h5>
                    <h6 class="item_price">132</h6>
                    <div class="flex">
                        <span class="btn_dec">-</span>  <!--수량조절-->
                        <span class="count_items">1</span>
                        <span class="btn_inc">+</span>
                    </div>
                </li>
                <li>
                    <button name="delete_btn" class="btn delete"><span>X</span></button> <!--버킷 삭제버튼-->
                </li>
            </ul>
            <ul class="buckets flex">
                <li><input type="checkbox" name = "items"></li>
                <li>
                    <a href="#"><img src="./images/img5.png" alt="img3"/></a>
                </li>
                <li>
                    <h5 class="item_name">미인활명수</h5>
                    <h6 class="item_price"> 1400원</h6>
                    <div class="flex">
                        <span class="btn_dec">-</span>
                        <span class="count_items">1</span>
                        <span class="btn_inc">+</span>
                    </div>
                </li>
                <li>
                    <button name="delete_btn" class="btn delete">X</button>
                </li>
            </ul>
            <ul class="buckets flex">
                <li><input type="checkbox" name = "items"></li>
                <li>
                    <a href="#"><img src="./images/img7.png" alt="img3"/></a>
                </li>
                <li>
                    <h5 class="item_name">꼬마활명수</h5>
                    <h6 class="item_price">1800원</h6>
                    <div class="flex">
                        <span class="btn_dec">-</span>
                        <span class="count_items">1</span>
                        <span class="btn_inc">+</span>
                    </div>
                </li>
                <li>
                    <button name="delete_btn" class="btn delete">X</button>
                </li>
            </ul>
            <ul class="buckets flex">
                <li><input type="checkbox" name = "items"></li>
                <li>
                    <a href="#"><img src="./images/img2.png" alt="img3"/></a>
                </li>
                <li>
                    <h5 class="item_name">까스활</h5>
                    <h6 class="item_price">1500원</h6>
                    <div class="flex">
                        <span class="btn_dec">-</span>
                        <span class="count_items">1</span>
                        <span class="btn_inc">+</span>
                    </div>
                </li>
                <li>
                    <button name="delete_btn" class="btn delete">X</button>
                </li>
            </ul>
        </article>
    </div>
</section>
<!--하부 픽스되는 결제링크 섹션-->
<section id = "fixedzone">
    <div id="to_pay_link">
        <div class="wrap">
            <article class="flex">
                <h4>결제 예정금액</h4>
                <h4>25000원</h4>
            </article>
            <article class="flex">
                <h5>4개 상품 22000원 + 배송비 3000원</h5>
                <h5>주문하기</h5>
            </article>
        </div>
    </div>
</section>

<footer class="flex">
    <div>
        <h2 id="logo_footer"><a href="#">logo</a></h2>
    </div>
    <div>
        <ul>
            <li><a href="#">개인정보취급방침</a></li>
            <li>
                <address>
                <p>대표이사 : 유준하, 한종현</p>
                <p>사업자등록번호 : 110-81-00102</p>
                <p>Mail : dongwha@dong-wha.co.kr</p>
                <p>Tel : 02-2021-9300</p>
                <p>04522 서울특별시 중구 남대문로9길 24 패스트파이브 타워 6~8층</p>
                <p>Copyright&copy; DONG WHA PHARM. CO., LTD. ALL Rights Reserved</p>
            </address>
            </li>
        </ul>
    </div>
    <div id="social_icon">
        <ul class="flex">
            <li><a href="#"><img src="./images/social_icon_1.png" alt="icon_social_1"></a></li>
            <li><a href="#"><img src="./images/social_icon_2.png" alt="icon_social_2"></a></li>
            <li><a href="#"><img src="./images/social_icon_3.png" alt="icon_social_3"></a></li>
            <li><a href="#"><img src="./images/social_icon_4.png" alt="icon_social_4"></a></li>
        </ul>
    </div>

</footer>

<script>
    let item1 = {
        name : '까스활명수',
        price : 1200
    };
    let item2 = {
        name : '미인활명수',
        price : 1400
    };
    let item3 = {
        name : '꼬마활명수',
        price : 1800
    };
    let item4 = {
        name : '까스활',
        price : 1500
    };
    let items = [0, item1.price, item2.price, item3.price, item4.price];
    

    //초기화
    $(document).ready(function(){
        $(".buckets:nth-of-type(1) .item_name").html(item1.name);
        $(".buckets:nth-of-type(1) .item_price").html(item1.price+"원");

        $(".buckets:nth-of-type(2) .item_name").html(item2.name);
        $(".buckets:nth-of-type(2) .item_price").html(item2.price+"원");

        $(".buckets:nth-of-type(3) .item_name").html(item3.name);
        $(".buckets:nth-of-type(3) .item_price").html(item3.price+"원");

        $(".buckets:nth-of-type(4) .item_name").html(item4.name);
        $(".buckets:nth-of-type(4) .item_price").html(item4.price+"원");

            
        list_delete();  //리스트삭제
        bucketslist();  //건수 구하기
        list_refresh(); // 건수 새로고침
        paybanner();    //구매하기배너
    });

    //총 건수
    let bucketslist = function(){   //건수 구하기
        return $(".buckets").length;
    };
    let list_refresh = function(){  //새로고침
        $("#counting_buckets>h3").html("총 "+bucketslist()+"건");
    };


    // 가격계산
    $(function(){
        //감소버튼
        $(".btn_dec").click(function(){
            if(parseInt($(this).siblings(".count_items").text()) >= 2){  //2 이상일때만 감소
                let nowcnt = parseInt($(this).siblings(".count_items").text());
                let aftercnt = nowcnt - 1;
                $(this).siblings(".count_items").html(aftercnt);
                let idx = $(this).parents("ul").index() + 1;

                let afterprice = price(aftercnt, idx);  //계산함수 호출
                $(this).parent("div").siblings(".item_price").html(afterprice+"원");

                paybanner();
            };
        });
        //증가버튼
        $(".btn_inc").click(function(){
            let nowcnt = parseInt($(this).siblings(".count_items").text());
            let aftercnt = nowcnt + 1;
            $(this).siblings(".count_items").html(aftercnt);
            let idx = $(this).parents("ul").index() + 1;

            let afterprice = price(aftercnt, idx);  //계산함수 호출
            $(this).parent("div").siblings(".item_price").html(afterprice+"원");

            paybanner();
        });
    });
    //가격계산식
    function price(aftercnt, idx){
            return items[idx] * aftercnt;
        }; 

    //총금액계산
    let sumprice = function(){
        let sum = 0;
        for(let i = 0; i < bucketslist(); i++){
            let sprs = parseInt($(".buckets:nth-of-type("+(i+1)+") .item_price").text());
            sum = sum + sprs;
        }
        return sum;
    };

    //결제 링크 배너 최신화
    let paybanner = function(){
        $("#to_pay_link h5:first-child").html(bucketslist()+"개 상품 "+"총 "+sumprice()+"원 + 배송비 3000원 입니다.");
        $("#to_pay_link h4:last-child").html("총 "+(sumprice()+3000)+"원")
    };

    //결제 링크 배너 이동관련
    $(window).scroll(function(){
        let banner_heightY = $("#to_pay_link").offset().top;//배너의 현재높이
        let fixedzone = $("#fixedzone").offset().top;   //멈춰야 할 곳
        
        
        //좌표값이동?
        if(banner_heightY > fixedzone){     //배너가 위치에 도달하면
            $("#to_pay_link").css("position","static");

        }else if(banner_heightY <= fixedzone){
            $("#to_pay_link").css("position","fixed")
        }
    });

    //체크
    $(function(){
        $("#checkall").click(function(){
            if(($("#cbx_chkAll").is(":checked"))){
                $("input[name=items]").prop("checked", true);
            }else{
                $("input[name=items]").prop("checked", false);
            };
        });
    });

    //


    //삭제
    
    let list_delete = function(){
        $("button.delete").click(function(){
            $(this).parents(".buckets").remove();
            bucketslist();
            list_refresh();
            paybanner();
        });
    };
    


    

</script>
</body>
</html>